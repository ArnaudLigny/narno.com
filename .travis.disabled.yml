language: php
php:
  - 7.2
sudo: false
branches:
  only:
    - master
# Download Cecil
install:
  - curl -SOL https://cecil.app/cecil.phar
# Display Cecil version
before_script:
  - php cecil.phar -v
# Run Cecil build
script:
  - php cecil.phar build -q
# Deploy to GitHub Pages
deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GH_TOKEN
  local_dir: _site
  on:
    branch: master
# Flush Cloudflare cache
after_deploy:
  - "curl -X DELETE \"https://api.cloudflare.com/client/v4/zones/${Cloudflare_zone}/purge_cache\" \
    -H \"X-Auth-Email: arnaud@ligny.org\" \
    -H \"X-Auth-Key: ${Cloudflare_API}\" \
    -H \"Content-Type: application/json\" \
    --data '{\"purge_everything\":true}'"
